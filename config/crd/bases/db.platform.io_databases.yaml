---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: databases.db.platform.io
spec:
  group: db.platform.io
  names:
    kind: Database
    listKind: DatabaseList
    plural: databases
    shortNames:
    - db
    - dbs
    singular: database
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.engine
      name: Engine
      type: string
    - jsonPath: .spec.version
      name: Version
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.readyReplicas
      name: Ready
      type: integer
    - jsonPath: .status.endpoint
      name: Endpoint
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: Database is the Schema for the databases API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: DatabaseSpec defines the desired state of Database
            properties:
              auth:
                description: Auth defines authentication configuration
                properties:
                  consul:
                    description: Consul enables Consul integration for credential
                      management
                    properties:
                      address:
                        description: Address specifies the Consul server address
                        type: string
                      enabled:
                        description: Enabled indicates if Consul integration is enabled
                        type: boolean
                      path:
                        description: Path specifies the Consul KV path for credentials
                        type: string
                      tokenSecretRef:
                        description: Token specifies the Consul token (should reference
                          a secret)
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            description: |-
                              Name of the referent.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                              TODO: Add other useful fields. apiVersion, kind, uid?
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                    type: object
                  rotationPolicy:
                    description: RotationPolicy defines credential rotation configuration
                    properties:
                      enabled:
                        description: Enabled indicates if automatic rotation is enabled
                        type: boolean
                      schedule:
                        description: Schedule specifies the rotation schedule in cron
                          format
                        type: string
                      strategy:
                        default: TwoPhase
                        description: Strategy defines the rotation strategy (TwoPhase,
                          Immediate)
                        type: string
                    type: object
                  secretName:
                    description: SecretName specifies the secret containing credentials
                    type: string
                type: object
              backup:
                description: Backup defines backup configuration
                properties:
                  destination:
                    description: Destination specifies the backup destination
                    properties:
                      pvc:
                        description: PVC specifies PVC storage configuration
                        properties:
                          size:
                            description: Size specifies the PVC size
                            type: string
                          storageClassName:
                            description: StorageClassName specifies the storage class
                            type: string
                        required:
                        - size
                        type: object
                      s3:
                        description: S3 specifies S3 storage configuration
                        properties:
                          bucket:
                            description: Bucket specifies the S3 bucket name
                            type: string
                          credentialsSecret:
                            description: CredentialsSecret specifies the secret containing
                              S3 credentials
                            type: string
                          endpoint:
                            description: Endpoint specifies the S3 endpoint
                            type: string
                          region:
                            description: Region specifies the S3 region
                            type: string
                        required:
                        - bucket
                        - credentialsSecret
                        type: object
                    type: object
                  enabled:
                    description: Enabled indicates if backups are enabled
                    type: boolean
                  method:
                    default: Snapshot
                    description: Method specifies the backup method
                    enum:
                    - Snapshot
                    - Dump
                    - WAL
                    - Incremental
                    type: string
                  retention:
                    default: 7
                    description: Retention specifies the backup retention policy
                    format: int32
                    type: integer
                  schedule:
                    description: Schedule specifies the backup schedule in cron format
                    type: string
                type: object
              engine:
                description: Engine specifies the database engine type
                enum:
                - PostgreSQL
                - MongoDB
                - Redis
                - Elasticsearch
                - SQLite
                type: string
              engineConfig:
                additionalProperties:
                  type: string
                description: EngineConfig provides engine-specific configuration as
                  an opaque map
                type: object
                x-kubernetes-preserve-unknown-fields: true
              lifecycle:
                description: Lifecycle defines lifecycle management configuration
                properties:
                  deletionPolicy:
                    default: Retain
                    description: DeletionPolicy defines the deletion policy
                    enum:
                    - Retain
                    - Snapshot
                    - Delete
                    type: string
                  paused:
                    description: Paused indicates if reconciliation is paused
                    type: boolean
                  postStartHook:
                    description: PostStartHook defines a post-start hook
                    properties:
                      exec:
                        description: Exec specifies a command to execute
                        properties:
                          command:
                            description: |-
                              Command is the command line to execute inside the container, the working directory for the
                              command  is root ('/') in the container's filesystem. The command is simply exec'd, it is
                              not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use
                              a shell, you need to explicitly call out to that shell.
                              Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                            items:
                              type: string
                            type: array
                        type: object
                      httpGet:
                        description: HTTPGet specifies an HTTP request
                        properties:
                          host:
                            description: |-
                              Host name to connect to, defaults to the pod IP. You probably want to set
                              "Host" in httpHeaders instead.
                            type: string
                          httpHeaders:
                            description: Custom headers to set in the request. HTTP
                              allows repeated headers.
                            items:
                              description: HTTPHeader describes a custom header to
                                be used in HTTP probes
                              properties:
                                name:
                                  description: |-
                                    The header field name.
                                    This will be canonicalized upon output, so case-variant names will be understood as the same header.
                                  type: string
                                value:
                                  description: The header field value
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          path:
                            description: Path to access on the HTTP server.
                            type: string
                          port:
                            anyOf:
                            - type: integer
                            - type: string
                            description: |-
                              Name or number of the port to access on the container.
                              Number must be in the range 1 to 65535.
                              Name must be an IANA_SVC_NAME.
                            x-kubernetes-int-or-string: true
                          scheme:
                            description: |-
                              Scheme to use for connecting to the host.
                              Defaults to HTTP.
                            type: string
                        required:
                        - port
                        type: object
                    type: object
                  preStopHook:
                    description: PreStopHook defines a pre-stop hook
                    properties:
                      exec:
                        description: Exec specifies a command to execute
                        properties:
                          command:
                            description: |-
                              Command is the command line to execute inside the container, the working directory for the
                              command  is root ('/') in the container's filesystem. The command is simply exec'd, it is
                              not run inside a shell, so traditional shell instructions ('|', etc) won't work. To use
                              a shell, you need to explicitly call out to that shell.
                              Exit status of 0 is treated as live/healthy and non-zero is unhealthy.
                            items:
                              type: string
                            type: array
                        type: object
                      httpGet:
                        description: HTTPGet specifies an HTTP request
                        properties:
                          host:
                            description: |-
                              Host name to connect to, defaults to the pod IP. You probably want to set
                              "Host" in httpHeaders instead.
                            type: string
                          httpHeaders:
                            description: Custom headers to set in the request. HTTP
                              allows repeated headers.
                            items:
                              description: HTTPHeader describes a custom header to
                                be used in HTTP probes
                              properties:
                                name:
                                  description: |-
                                    The header field name.
                                    This will be canonicalized upon output, so case-variant names will be understood as the same header.
                                  type: string
                                value:
                                  description: The header field value
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          path:
                            description: Path to access on the HTTP server.
                            type: string
                          port:
                            anyOf:
                            - type: integer
                            - type: string
                            description: |-
                              Name or number of the port to access on the container.
                              Number must be in the range 1 to 65535.
                              Name must be an IANA_SVC_NAME.
                            x-kubernetes-int-or-string: true
                          scheme:
                            description: |-
                              Scheme to use for connecting to the host.
                              Defaults to HTTP.
                            type: string
                        required:
                        - port
                        type: object
                    type: object
                type: object
              maintenance:
                description: Maintenance defines maintenance window configuration
                properties:
                  autoUpgrade:
                    description: AutoUpgrade enables automatic upgrades during maintenance
                      windows
                    type: boolean
                  windows:
                    description: Windows specifies allowed maintenance windows
                    items:
                      description: MaintenanceWindow defines a maintenance window
                      properties:
                        dayOfWeek:
                          description: DayOfWeek specifies the day of week (0-6, 0
                            = Sunday)
                          maximum: 6
                          minimum: 0
                          type: integer
                        duration:
                          description: Duration specifies the window duration
                          type: string
                        startTime:
                          description: StartTime specifies the start time (HH:MM format)
                          pattern: ^([0-1][0-9]|2[0-3]):[0-5][0-9]$
                          type: string
                      required:
                      - dayOfWeek
                      - duration
                      - startTime
                      type: object
                    type: array
                type: object
              networking:
                description: Networking defines network configuration
                properties:
                  externalDNS:
                    description: ExternalDNS specifies external DNS name
                    type: string
                  port:
                    description: Port specifies the service port
                    format: int32
                    type: integer
                  serviceType:
                    default: ClusterIP
                    description: ServiceType specifies the Kubernetes service type
                    type: string
                  tls:
                    description: TLS enables TLS/SSL
                    properties:
                      certManager:
                        description: CertManager enables cert-manager integration
                        type: boolean
                      enabled:
                        description: Enabled indicates if TLS is enabled
                        type: boolean
                      secretName:
                        description: SecretName specifies the secret containing TLS
                          certificates
                        type: string
                    type: object
                type: object
              observability:
                description: Observability defines monitoring and metrics configuration
                properties:
                  logging:
                    description: Logging defines logging configuration
                    properties:
                      format:
                        default: json
                        description: Format specifies the log format (json, text)
                        type: string
                      level:
                        default: info
                        description: Level specifies the log level
                        type: string
                    type: object
                  metrics:
                    description: Metrics enables metrics export
                    properties:
                      enabled:
                        description: Enabled indicates if metrics are enabled
                        type: boolean
                      port:
                        default: 9090
                        description: Port specifies the metrics port
                        format: int32
                        type: integer
                      serviceMonitor:
                        description: ServiceMonitor enables ServiceMonitor creation
                        type: boolean
                    type: object
                  tracing:
                    description: Tracing defines tracing configuration
                    properties:
                      enabled:
                        description: Enabled indicates if tracing is enabled
                        type: boolean
                      endpoint:
                        description: Endpoint specifies the tracing collector endpoint
                        type: string
                    type: object
                type: object
              profile:
                default: default
                description: Profile specifies the performance/resource profile (e.g.,
                  dev, prod, high-memory)
                type: string
              resources:
                description: Resources defines compute resources
                properties:
                  claims:
                    description: |-
                      Claims lists the names of resources, defined in spec.resourceClaims,
                      that are used by this container.


                      This is an alpha field and requires enabling the
                      DynamicResourceAllocation feature gate.


                      This field is immutable. It can only be set for containers.
                    items:
                      description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                      properties:
                        name:
                          description: |-
                            Name must match the name of one entry in pod.spec.resourceClaims of
                            the Pod where this field is used. It makes that resource available
                            inside a container.
                          type: string
                      required:
                      - name
                      type: object
                    type: array
                    x-kubernetes-list-map-keys:
                    - name
                    x-kubernetes-list-type: map
                  limits:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: |-
                      Limits describes the maximum amount of compute resources allowed.
                      More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                    type: object
                  requests:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: |-
                      Requests describes the minimum amount of compute resources required.
                      If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                      otherwise to an implementation-defined value. Requests cannot exceed Limits.
                      More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                    type: object
                type: object
              restore:
                description: Restore defines restore configuration
                properties:
                  backupName:
                    description: BackupName specifies the backup to restore from
                    type: string
                  pointInTime:
                    description: PointInTime specifies point-in-time recovery timestamp
                    format: date-time
                    type: string
                required:
                - backupName
                type: object
              storage:
                description: Storage defines storage configuration
                properties:
                  size:
                    default: 10Gi
                    description: Size specifies the storage size
                    type: string
                  snapshots:
                    description: Snapshots enables volume snapshots
                    type: boolean
                  storageClassName:
                    description: StorageClassName specifies the storage class
                    type: string
                  volumeMode:
                    default: Filesystem
                    description: VolumeMode specifies the volume mode (Filesystem
                      or Block)
                    type: string
                type: object
              topology:
                description: Topology defines the deployment topology
                properties:
                  antiAffinity:
                    description: AntiAffinity enables pod anti-affinity
                    type: boolean
                  mode:
                    default: Standalone
                    description: Mode specifies the topology mode
                    enum:
                    - Standalone
                    - Replicated
                    - Cluster
                    - Sharded
                    type: string
                  replicas:
                    default: 1
                    description: Replicas specifies the number of replicas
                    format: int32
                    maximum: 100
                    minimum: 1
                    type: integer
                  shards:
                    description: Shards specifies the number of shards (for sharded
                      topology)
                    format: int32
                    minimum: 1
                    type: integer
                type: object
              version:
                description: Version specifies the database version
                pattern: ^[0-9]+\.[0-9]+(\.[0-9]+)?$
                type: string
            required:
            - engine
            - version
            type: object
          status:
            description: DatabaseStatus defines the observed state of Database
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the database's state
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource.\n---\nThis struct is intended for
                    direct use as an array at the field path .status.conditions.  For
                    example,\n\n\n\ttype FooStatus struct{\n\t    // Represents the
                    observations of a foo's current state.\n\t    // Known .status.conditions.type
                    are: \"Available\", \"Progressing\", and \"Degraded\"\n\t    //
                    +patchMergeKey=type\n\t    // +patchStrategy=merge\n\t    // +listType=map\n\t
                    \   // +listMapKey=type\n\t    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`\n\n\n\t
                    \   // other fields\n\t}"
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: |-
                        type of condition in CamelCase or in foo.example.com/CamelCase.
                        ---
                        Many .condition.type values are consistent across resources like Available, but because arbitrary conditions can be
                        useful (see .node.status.conditions), the ability to deconflict is important.
                        The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              currentVersion:
                description: CurrentVersion is the currently running database version
                type: string
              endpoint:
                description: Endpoint represents the connection endpoint
                type: string
              health:
                description: Health represents the health status of the database
                properties:
                  lastCheckTime:
                    description: LastCheckTime is the last time health was checked
                    format: date-time
                    type: string
                  message:
                    description: Message provides additional health information
                    type: string
                  status:
                    description: Status indicates the health status (Healthy, Degraded,
                      Unhealthy, Unknown)
                    type: string
                type: object
              lastBackup:
                description: LastBackup represents the last successful backup timestamp
                format: date-time
                type: string
              lastReconcileTime:
                description: LastReconcileTime is the last time reconciliation was
                  performed
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the most
                  recently observed Database spec
                format: int64
                type: integer
              phase:
                description: Phase represents the current phase of the database
                enum:
                - Pending
                - Provisioning
                - Ready
                - Upgrading
                - Scaling
                - Healing
                - Failed
                - Paused
                - Deleting
                type: string
              readyReplicas:
                description: ReadyReplicas is the number of ready replicas
                format: int32
                type: integer
              rotationStatus:
                description: RotationStatus tracks the status of credential rotation
                properties:
                  jobName:
                    description: JobName is the name of the rotation job
                    type: string
                  lastRotation:
                    description: LastRotation is the timestamp of the last successful
                      rotation
                    format: date-time
                    type: string
                  nextRotation:
                    description: NextRotation is the timestamp of the next scheduled
                      rotation
                    format: date-time
                    type: string
                  phase:
                    description: Phase indicates the rotation phase (Idle, CreatingNew,
                      Cutover, Revoking, Complete)
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
